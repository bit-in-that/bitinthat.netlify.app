---
title: "AFLW Fantasy Top Coaches"
execute:
  echo: false
---

```{r}
#| message: false

library(modules)
library(arrow)
library(reactable)
library(dplyr)
library(htmltools)

linked_icons <- use("../../modules/linked_icons.R")

round_number <- 1L

content_creators_ranks <- read_parquet("https://github.com/bit-in-that/data-automation/raw/main/aflw_fantasy/data/processed/content_creators_ranks_aflw.parquet") |>
mutate( 
    img_url = paste0("https://aflwfantasy.afl/media/avatars/user/", user_id, ".png?v=1"),
    fantasy_url = paste0("https://aflwfantasy.afl/user/team/1/", team_id_2023)
  ) |> 
  select("team_name", "overall_rank", "total_points", "name", "individual_url", "organisation", "twitter", "facebook", "website", "YouTube", "spotify", "primary_url", "img_url", "fantasy_url", "user_id") |> 
  arrange(overall_rank)


```

*The data below is as at round `r round_number` of the 2023 AFLW season.*

# {{< fa bullhorn >}} High Profile

Check out the track records of podcast hosts and other high profile coaches below.

```{r}
content_creators_ranks |> 
  select(-user_id) |> 
  reactable(
    columns = list(
      team_name = colDef(
        name = "Fantasy Team",
        sticky = "left",
        cell = function(cell_value, row_index, column_name) {
          img_url <- content_creators_ranks[["img_url"]][[row_index]]
          fantasy_url <- content_creators_ranks[["fantasy_url"]][[row_index]]
          tags$a(
            tags$img(src = img_url, style = "height: 24px;width: 24px;"),
            " ",
            cell_value,
            href = fantasy_url, 
            target = "_blank"
            )
        },
        width = 200
      ),
      name = colDef(
        name = "Person",
        cell = function(cell_value, row_index, column_name) {
          individual_url <- content_creators_ranks[["individual_url"]][[row_index]]
          tags$a(
            cell_value,
            href = individual_url,
            target = "_blank"
            )
        },
        width = 175
      ),
      organisation = colDef(
        name = "Name",
        cell = function(cell_value, row_index, column_name) {
          primary_url <- content_creators_ranks[["primary_url"]][[row_index]]
          tags$a(
            cell_value,
            href = primary_url,
            target = "_blank"
            )
        },
        width = 200
      ),
      primary_url = colDef(
        name = "Links",
        cell = function(cell_value, row_index, column_name) {
          twitter <- content_creators_ranks[["twitter"]][[row_index]]
          facebook <- content_creators_ranks[["facebook"]][[row_index]]
          website <- content_creators_ranks[["website"]][[row_index]]
          YouTube <- content_creators_ranks[["YouTube"]][[row_index]]
          spotify <- content_creators_ranks[["spotify"]][[row_index]]
          
          tagList(
            if(isFALSE(twitter == "")) linked_icons$linked_twitter_icon(twitter) else NULL,
            if(isFALSE(facebook == "")) linked_icons$linked_facebook_icon(facebook) else NULL,
            if(isFALSE(website == "")) linked_icons$linked_globe_icon(website) else NULL,
            if(isFALSE(YouTube == "")) linked_icons$linked_youtube_icon(YouTube) else NULL,
            if(isFALSE(spotify == "")) linked_icons$linked_spotify_icon(spotify) else NULL
          )
        },
        width = 120
      ),
      overall_rank = colDef(name = "Overall Rank", width = 100, format = colFormat(separators = TRUE)),
      total_points = colDef(name = "Total Points", width = 75, format = colFormat(separators = TRUE)),
      individual_url = colDef(show = FALSE),
      twitter = colDef(show = FALSE),
      facebook = colDef(show = FALSE),
      website = colDef(show = FALSE),
      YouTube = colDef(show = FALSE),
      spotify = colDef(show = FALSE),
      img_url = colDef(show = FALSE),
      fantasy_url = colDef(show = FALSE)
    ),
    columnGroups = list(
      colGroup(name = "", columns = c("overall_rank", "total_points")),
      colGroup(name = "Organisation", columns = c("organisation", "twitter", "facebook", "website", "YouTube", "spotify", "primary_url"))
      ),
    fullWidth = FALSE,
    filterable = TRUE
  )


```

